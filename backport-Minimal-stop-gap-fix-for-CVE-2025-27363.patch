From d4addbb412a6169020ddf8ec0216772a8bab9d18 Mon Sep 17 00:00:00 2001
From: 18809208922 <kouzhenrong@huawei.com>
Date: Mon, 14 Apr 2025 20:29:05 +0800
Subject: [PATCH] Minimal stop-gap fix for CVE-2025-27363

---
 src/truetype/ttgload.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/truetype/ttgload.c b/src/truetype/ttgload.c
index 2ca63d6..7ce6d2a 100644
--- a/src/truetype/ttgload.c
+++ b/src/truetype/ttgload.c
@@ -1948,7 +1948,7 @@
         short        i, limit;
         FT_SubGlyph  subglyph;
 
-        FT_Outline  outline;
+        FT_Outline  outline = { 0, 0, NULL, NULL, NULL, 0 };
         FT_Vector*  points    = NULL;
         char*       tags      = NULL;
         short*      contours  = NULL;
@@ -1957,6 +1957,13 @@
 
         limit = (short)gloader->current.num_subglyphs;
 
+        /* make sure this isn't negative as we're going to add 4 later */
+        if ( limit < 0 )
+        {
+          error = FT_THROW( Invalid_Argument );
+          goto Exit;
+        }
+
         /* construct an outline structure for              */
         /* communication with `TT_Vary_Apply_Glyph_Deltas' */
         outline.n_points   = (short)( gloader->current.num_subglyphs + 4 );
-- 
2.44.0.windows.1

